{"ast":null,"code":"import { URL_BACKEND } from '../../environments/environments';\nimport { FIN_CARGANDO_LOGIN, INICIO_CARGANDO_LOGIN, SET_SUCCESS_LOGIN } from '../types/types';\nimport axios from 'axios';\n\nconst inicioCargandoLogin = () => {\n  return {\n    type: INICIO_CARGANDO_LOGIN\n  };\n};\n\nconst finCargandoLogin = () => {\n  return {\n    type: FIN_CARGANDO_LOGIN\n  };\n};\n\nexport const iniciarSesionAction = (correo, password) => {\n  return async dispatch => {\n    dispatch(inicioCargandoLogin());\n    const endpoint = `${URL_BACKEND}/login`;\n    console.log(correo);\n    console.log(password);\n    const response = await axios.post(endpoint, JSON.stringify({\n      username: correo,\n      password: password\n    }), {\n      headers: {\n        'Content-type': 'application/json'\n      }\n    });\n\n    if (response.status === 200) {\n      console.log(response.data.access);\n      let {\n        token\n      } = response.data.acc;\n      localStorage.setItem('token', token);\n      let payload = token.split('.')[1];\n      let payloadDecoded = atob(payload);\n      let payloadJSON = JSON.parse(payloadDecoded);\n      dispatch({\n        type: SET_SUCCESS_LOGIN,\n        payload: {\n          autenticado: true,\n          usu_nom: payloadJSON.usu_nom,\n          usu_id: payloadJSON.usu_id,\n          usu_tipo: payloadJSON.usu_tipo,\n          token: token\n        }\n      });\n    }\n\n    dispatch(finCargandoLogin());\n  };\n};\nexport const iniciarSesionLocalStorage = () => {\n  return async dispatch => {\n    dispatch(inicioCargandoLogin());\n    let token = localStorage.getItem('token');\n\n    try {\n      if (token) {\n        /*const endpoint = `${URL_BACKEND}/verificar`;\r\n        const response = await axios.post(endpoint, null, {\r\n        \theaders: {\r\n        \t\tauthorization: `Bearer ${token}`\r\n        \t}\r\n        });*/\n        //response.data.ok\n        if (1 == 1) {\n          let payload = token.split('.')[1];\n          let payloadDecoded = atob(payload);\n          let payloadJSON = JSON.parse(payloadDecoded);\n          dispatch({\n            type: SET_SUCCESS_LOGIN,\n            payload: {\n              autenticado: true,\n              usu_nom: payloadJSON.usu_nom,\n              usu_id: payloadJSON.usu_id,\n              usu_tipo: payloadJSON.usu_tipo,\n              token: token\n            }\n          });\n          dispatch(finCargandoLogin());\n        }\n      } else {\n        dispatch(finCargandoLogin());\n      }\n    } catch (error) {\n      console.log('errosh');\n      localStorage.removeItem('token');\n      dispatch(finCargandoLogin());\n    }\n  };\n};","map":{"version":3,"sources":["C:/Users/HP/Documents/Codigo-G13-BackEnd/semana01/semana05/dia3/pos_frontend/src/redux/actions/authAction.js"],"names":["URL_BACKEND","FIN_CARGANDO_LOGIN","INICIO_CARGANDO_LOGIN","SET_SUCCESS_LOGIN","axios","inicioCargandoLogin","type","finCargandoLogin","iniciarSesionAction","correo","password","dispatch","endpoint","console","log","response","post","JSON","stringify","username","headers","status","data","access","token","acc","localStorage","setItem","payload","split","payloadDecoded","atob","payloadJSON","parse","autenticado","usu_nom","usu_id","usu_tipo","iniciarSesionLocalStorage","getItem","error","removeItem"],"mappings":"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","sourcesContent":["import { URL_BACKEND } from '../../environments/environments';\r\nimport {\r\n\tFIN_CARGANDO_LOGIN,\r\n\tINICIO_CARGANDO_LOGIN,\r\n\tSET_SUCCESS_LOGIN\r\n} from '../types/types';\r\nimport axios from 'axios';\r\nconst inicioCargandoLogin = () => {\r\n\treturn {\r\n\t\ttype: INICIO_CARGANDO_LOGIN\r\n\t};\r\n};\r\nconst finCargandoLogin = () => {\r\n\treturn {\r\n\t\ttype: FIN_CARGANDO_LOGIN\r\n\t};\r\n};\r\n\r\nexport const iniciarSesionAction = (correo, password) => {\r\n\treturn async (dispatch) => {\r\n\t\tdispatch(inicioCargandoLogin());\r\n\r\n\t\tconst endpoint = `${URL_BACKEND}/login`;\r\n\t\tconsole.log(correo);\r\n\t\tconsole.log(password);\r\n\t\tconst response = await axios.post(\r\n\t\t\tendpoint,\r\n\t\t\tJSON.stringify({ username: correo, password: password }),\r\n\t\t\t{\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-type': 'application/json'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t\tif (response.status === 200) {\r\n\t\t\tconsole.log(response.data.access);\r\n\t\t\tlet { token } = response.data.acc;\r\n\t\t\tlocalStorage.setItem('token', token);\r\n\t\t\tlet payload = token.split('.')[1];\r\n\t\t\tlet payloadDecoded = atob(payload);\r\n\t\t\tlet payloadJSON = JSON.parse(payloadDecoded);\r\n\t\t\tdispatch({\r\n\t\t\t\ttype: SET_SUCCESS_LOGIN,\r\n\t\t\t\tpayload: {\r\n\t\t\t\t\tautenticado: true,\r\n\t\t\t\t\tusu_nom: payloadJSON.usu_nom,\r\n\t\t\t\t\tusu_id: payloadJSON.usu_id,\r\n\t\t\t\t\tusu_tipo: payloadJSON.usu_tipo,\r\n\t\t\t\t\ttoken: token\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tdispatch(finCargandoLogin());\r\n\t};\r\n};\r\n\r\nexport const iniciarSesionLocalStorage = () => {\r\n\treturn async (dispatch) => {\r\n\t\tdispatch(inicioCargandoLogin());\r\n\t\tlet token = localStorage.getItem('token');\r\n\t\ttry {\r\n\t\t\tif (token) {\r\n\t\t\t\t/*const endpoint = `${URL_BACKEND}/verificar`;\r\n\t\t\t\tconst response = await axios.post(endpoint, null, {\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tauthorization: `Bearer ${token}`\r\n\t\t\t\t\t}\r\n\t\t\t\t});*/\r\n\t\t\t\t//response.data.ok\r\n\t\t\t\tif (1==1) {\r\n\t\t\t\t\tlet payload = token.split('.')[1];\r\n\t\t\t\t\tlet payloadDecoded = atob(payload);\r\n\t\t\t\t\tlet payloadJSON = JSON.parse(payloadDecoded);\r\n\t\t\t\t\tdispatch({\r\n\t\t\t\t\t\ttype: SET_SUCCESS_LOGIN,\r\n\t\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\t\tautenticado: true,\r\n\t\t\t\t\t\t\tusu_nom: payloadJSON.usu_nom,\r\n\t\t\t\t\t\t\tusu_id: payloadJSON.usu_id,\r\n\t\t\t\t\t\t\tusu_tipo: payloadJSON.usu_tipo,\r\n\t\t\t\t\t\t\ttoken: token\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdispatch(finCargandoLogin());\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdispatch(finCargandoLogin());\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('errosh');\r\n\t\t\tlocalStorage.removeItem('token');\r\n\t\t\tdispatch(finCargandoLogin());\r\n\t\t}\r\n\t};\r\n};\r\n"]},"metadata":{},"sourceType":"module"}